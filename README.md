# Korea EV Charger Cost (한국 전기차 충전 요금 계산기)

한국전력(KEPCO)의 계절별/시간대별 요금표를 기반으로 전기차 충전 요금을 실시간으로 계산해주는 Home Assistant 커스텀 컴포넌트입니다.

## ✨ 주요 기능

- **KEPCO 요금표 완벽 구현**: 계절(여름, 봄/가을, 겨울) 및 시간대(경부하, 중간부하, 최대부하)에 따른 요금을 자동으로 적용합니다.
- **예외 규칙 적용**:
  - **토요일**: 최대부하 시간대를 중간부하 요금으로 자동 적용
  - **공휴일/일요일**: 하루 종일 경부하 요금 적용
- **사용자 설정 가능**:
  - 저압/고압 선택 가능
  - 구성 옵션(Options)을 통해 요금 단가가 변경될 경우 사용자가 직접 수정 가능
- **공휴일 센서 연동**: `workday` 센서 등과 연동하여 공휴일을 자동으로 인식합니다.

## 📦 설치 방법 (Installation)

### HACS를 통한 설치 (권장)
1. HACS > Integrations > 우측 상단 메뉴 > **Custom repositories** 선택
2. Repository URL에 이 깃허브 주소를 입력하고 Category를 **Integration**으로 선택 후 추가
3. HACS 목록에서 `Korea EV Charger Cost` 검색 및 설치
4. Home Assistant 재시작

### 수동 설치
1. 최신 릴리즈의 소스 코드를 다운로드합니다.
2. `custom_components/korea_ev_charger` 폴더를 통째로 내 Home Assistant의 `config/custom_components/` 경로에 복사합니다.
3. Home Assistant를 재시작합니다.

## ⚙️ 설정 방법 (Configuration)

1. Home Assistant에서 **설정(Settings) > 기기 및 서비스(Devices & Services)** 로 이동합니다.
2. 우측 하단 **통합구성요소 추가(+ ADD INTEGRATION)** 버튼을 누릅니다.
3. **Korea EV Charger Cost**를 검색하여 선택합니다.
4. 아래 항목을 입력합니다:
   - **Source Sensor**: 충전기의 전력량 센서 (kWh 단위, 예: `sensor.wallbox_energy_total`)
   - **Voltage Type**: 계약 전력 종류 선택 (저압/고압)
   - **Holiday Sensor (선택)**: 공휴일 여부를 판단할 Binary Sensor (예: `binary_sensor.workday_sensor`). 
     - *센서가 `on`이면 평일, `off`면 휴일로 인식하는 로직이 있다면 반대로 동작할 수 있으니 주의하세요. 이 컴포넌트는 연결된 센서가 `on`일 때를 공휴일(또는 휴일)로 인식하도록 로직을 확인해야 합니다.* (기본적으로 일요일은 센서 없이도 자동으로 경부하 처리됩니다.)

## 📊 활용 방법 (Utility Meter)

이 컴포넌트(`sensor.ev_charging_cost`)는 비용을 **계속 누적(Total)** 합니다.
월별 또는 일별 요금을 확인하려면 Home Assistant의 **도우미(Helper)** 기능인 `Utility Meter`를 사용하세요.

1. **설정 > 기기 및 서비스 > 도우미** 탭으로 이동
2. **+ 도우미 만들기 > 유틸리티 미터(Utility Meter)** 선택
3. 설정 예시:
   - **이름**: 이번 달 전기차 충전 요금
   - **입력 센서**: `sensor.ev_charging_cost` (이 컴포넌트가 만든 센서)
   - **주기**: 매달 (Monthly)
4. 이제 대시보드에 "이번 달 전기차 충전 요금" 센서를 추가하면 매월 1일에 0원으로 초기화되는 요금을 볼 수 있습니다.

## 📝 요금 단가 수정

한전 전기요금이 인상되거나 변경된 경우, 코드를 수정할 필요 없이 설정을 변경할 수 있습니다.

1. **설정 > 기기 및 서비스 > Korea EV Charger Cost** 항목의 **구성하기(Configure)** 버튼 클릭
2. 계절별/부하별 요금 단가를 직접 수정 후 저장

## 💡 참고 로직 (시간대)

기본적으로 아래의 시간표를 따릅니다. (설정된 표 기준)

| 구분 | 여름철 (6~8월) | 봄/가을철 (3~5, 9~10월) | 겨울철 (11~2월) |
| --- | --- | --- | --- |
| **경부하** | 22:00 ~ 08:00 | 22:00 ~ 08:00 | 22:00 ~ 08:00 |
| **중간부하** | 08시-11시, 12시-13시, 18시-22시 | 08시-11시, 12시-13시, 18시-22시 | 08시-09시, 12시-16시, 19시-22시 |
| **최대부하** | 11시-12시, 13시-18시 | 11시-12시, 13시-18시 | 09시-12시, 16시-19시 |

> **Note**: 토요일의 '최대부하' 시간대는 '중간부하' 요금으로 계산됩니다.

## License

MIT License